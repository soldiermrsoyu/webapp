<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laporan Maintenance - SPV</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    .report-card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      border: 1px solid var(--border-color);
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }
    
    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 12px;
      margin-bottom: 15px;
    }
    
    .unit-name {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--primary-color);
    }
    
    .report-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    @media (min-width: 640px) {
      .report-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .report-item {
      font-size: 0.9rem;
    }
    
    .report-label {
      font-weight: 600;
      color: var(--text-muted);
      display: block;
      margin-bottom: 4px;
      font-size: 0.8rem;
      text-transform: uppercase;
    }
    
    .report-value {
      color: var(--text-main);
      line-height: 1.4;
    }
    
    .report-footer {
      margin-top: 15px;
      padding-top: 12px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="container dashboard">
    <div class="header-section">
      <h1>Laporan Maintenance</h1>
      <button class="btn-back" onclick="location.href='/spv'">‚Üê Kembali</button>
    </div>

    <div id="laporanList">
      <p style="text-align: center; color: var(--text-muted);">Memuat laporan...</p>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="/spv" class="nav-item" id="home-nav">
      <div class="nav-icon">üè†</div>
      <div class="nav-label">Home</div>
    </a>
    <a href="/spv/notifikasi" class="nav-item" id="notif-nav">
      <div class="nav-icon">üîî</div>
      <div class="nav-label">Notifikasi</div>
    </a>
    <a href="/spv/profile" class="nav-item" id="profile-nav">
      <div class="nav-icon">üë§</div>
      <div class="nav-label">Profile</div>
    </a>
  </nav>

  <script>
    function loadLaporan() {
      fetch('/api/laporan-maintenance')
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById('laporanList');
          if (data.length === 0) {
            container.innerHTML = `
              <div class="empty-state">
                <div style="font-size: 3rem; margin-bottom: 10px;">üìÑ</div>
                <p>Belum ada laporan maintenance yang disubmit.</p>
              </div>
            `;
            return;
          }

          let html = '';
          data.forEach(item => {
            const dateDone = new Date(item.report_date).toLocaleString('id-ID', {
              day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
            });
            const nextDate = item.next_maintenance_date ? new Date(item.next_maintenance_date).toLocaleDateString('id-ID', {
              day: 'numeric', month: 'long', year: 'numeric'
            }) : 'Tidak dijadwalkan';

            html += `
              <div class="report-card">
                <div class="report-header">
                  <div>
                    <span class="unit-name">${item.unit}</span>
                    <div style="font-size: 0.85rem; color: var(--text-muted);">${item.lantai} ‚Ä¢ ${item.alias}</div>
                  </div>
                  <div style="text-align: right;">
                    <span style="font-weight: 600; color: var(--success-color);">‚úì Selesai</span>
                  </div>
                </div>
                
                <div class="report-grid">
                  <div class="report-item">
                    <span class="report-label">Temuan (Findings)</span>
                    <div class="report-value">${item.findings || '-'}</div>
                  </div>
                  <div class="report-item">
                    <span class="report-label">Tindakan (Actions Taken)</span>
                    <div class="report-value">${item.actions_taken || '-'}</div>
                  </div>
                  <div class="report-item">
                    <span class="report-label">Teknisi</span>
                    <div class="report-value">${item.teknisi_name}</div>
                  </div>
                  <div class="report-item">
                    <span class="report-label">Jadwal Berikutnya</span>
                    <div class="report-value" style="color: var(--primary-color); font-weight: 600;">${nextDate}</div>
                  </div>
                </div>
                
                <div class="report-footer">
                  <span>ID Tugas: #${item.assignment_id}</span>
                  <span>Selesai pada: ${dateDone}</span>
                </div>
              </div>
            `;
          });
          container.innerHTML = html;
        })
        .catch(err => {
          console.error('Error:', err);
          document.getElementById('laporanList').innerHTML = '<p style="text-align: center; color: var(--danger-color);">Gagal memuat laporan.</p>';
        });
    }

    loadLaporan();
  </script>
</body>
</html>
